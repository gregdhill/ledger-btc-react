(this["webpackJsonpledger-btc-react"]=this["webpackJsonpledger-btc-react"]||[]).push([[0],{183:function(t,e,n){t.exports=n(354)},188:function(t,e,n){},220:function(t,e){},222:function(t,e){},241:function(t,e){},244:function(t,e){},245:function(t,e){},346:function(t,e,n){},354:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),c=n(60),u=n.n(c),s=(n(188),n(50)),i=n(39),o=n(1),l=n.n(o),p=n(4),h=n(16),d=n(14),m=n(36),f=n(23),v=n(24),x=n(93),b=(n(69),function(){function t(){Object(h.a)(this,t),this.txApi=void 0,this.addrApi=void 0,this.blockApi=void 0;var e="https://blockstream.info/testnet/api";this.txApi=new x.TxApi({basePath:e}),this.addrApi=new x.AddressApi({basePath:e}),this.blockApi=new x.BlockApi({basePath:e})}return Object(d.a)(t,[{key:"getHexTransaction",value:function(){var t=Object(p.a)(l.a.mark((function t(e){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.txApi.getTxHex(e);case 2:return t.abrupt("return",t.sent.data);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getAccountValue",value:function(){var t=Object(p.a)(l.a.mark((function t(e){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.addrApi.getAddress(e);case 2:return n=t.sent.data,t.abrupt("return",n.chain_stats.funded_txo_sum||0);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getAccountUtxos",value:function(){var t=Object(p.a)(l.a.mark((function t(e){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.addrApi.getAddressUtxo(e);case 2:return n=t.sent.data,t.abrupt("return",n.map((function(t){return{txid:t.txid,value:t.value,vout:t.vout,addr:e,key:function(){return"".concat(t.txid).concat(t.vout)}}})));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"broadcastTx",value:function(){var t=Object(p.a)(l.a.mark((function t(e){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.txApi.postTx(e);case 2:return n=t.sent,t.abrupt("return",n.data);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}());function y(t){return t/Math.pow(10,8)}var E=n(49),k=n(361),g=n(356),w=n(360),O=n(359),S=(n(346),n(357)),j=n(177),A=n(358),B=n(91),C=n.n(B),T=n(59),I=function(t){Object(v.a)(n,t);var e=Object(f.a)(n);function n(){var t;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(t=e.call.apply(e,[this].concat(r))).state={loaded:!1,accIndex:0,accounts:new Map},t}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var t=Object(p.a)(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.props.accounts.size,this.setState({accounts:this.props.accounts,accIndex:e}),0!==e){t.next=7;break}return t.next=5,this.loadAccounts(3);case 5:t.next=8;break;case 7:this.setState({loaded:!0});case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"updateAccount",value:function(t,e){var n=this.state.accounts,a=e(n.get(t)||{checked:!1,index:0,value:0});n.set(t,a),this.setState({accounts:n}),this.props.updateAccount(t,(function(){return a}))}},{key:"loadAccounts",value:function(){var t=Object(p.a)(l.a.mark((function t(e){var n,a,r,c,u=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.state.accIndex,a=[],r=l.a.mark((function t(e){var n,r,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E.getWalletAddress(u.props.appBtc,e);case 2:n=t.sent,r=u.state.accounts,c={checked:!1,index:e,value:0},u.updateAccount(n,(function(){return c})),a.push(u.props.apiBtc.getAccountValue(n).then((function(t){var e=u.state.accounts;u.updateAccount(n,(function(e){return e.value=t,e})),u.setState({accounts:e})}))),u.setState({accounts:r});case 8:case"end":return t.stop()}}),t)})),c=n;case 4:if(!(c<n+e)){t.next=9;break}return t.delegateYield(r(c),"t0",6);case 6:c++,t.next=4;break;case 9:return t.next=11,Promise.all(a);case 11:this.setState({loaded:!0,accIndex:n+e});case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"onChange",value:function(t,e){var n=e.target.checked;this.updateAccount(t,(function(t){return t.checked=n,t})),n||this.props.removeAccountOutputs(t)}},{key:"render",value:function(){var t=this;return r.a.createElement("div",null,r.a.createElement(g.a,null,r.a.createElement("h1",{className:"header"},"Select Addresses")),r.a.createElement(S.a,{className:"justify-content-md-center"},r.a.createElement(j.a,null,r.a.createElement(A.a,{striped:!0,bordered:!0,hover:!0},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null),r.a.createElement("th",null),r.a.createElement("th",null,"Address"),r.a.createElement("th",null,"Value"))),r.a.createElement("tbody",null,Object(i.a)(this.state.accounts).map((function(e){return r.a.createElement("tr",{key:e[0]},r.a.createElement("td",null,r.a.createElement("input",{type:"checkbox",value:e[0],onChange:t.onChange.bind(t,e[0]),checked:e[1].checked})),r.a.createElement("td",null,r.a.createElement(C.a,{text:e[0]},r.a.createElement(T.a,{style:{cursor:"pointer"}}))),r.a.createElement("td",null,e[0]),r.a.createElement("td",null,y(e[1].value)," BTC"))})))))),r.a.createElement(S.a,{className:"justify-content-md-center"},this.state.loaded&&r.a.createElement(O.a,{onClick:function(){t.setState({loaded:!1}),t.loadAccounts(3)}},"Show More")))}}]),n}(a.Component),N=n(362),_=function(t){Object(v.a)(n,t);var e=Object(f.a)(n);function n(){var t;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(t=e.call.apply(e,[this].concat(r))).state={outputs:[],total:0},t}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var t=Object(p.a)(l.a.mark((function t(){var e,n,a,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.props,n=e.apiBtc,a=e.accounts,t.next=3,Promise.all(Object(i.a)(a).filter((function(t){return Object(s.a)(t,2)[1].checked})).map((function(t){var e=Object(s.a)(t,1)[0];return n.getAccountUtxos(e)})));case 3:r=t.sent,this.setState({outputs:r.flat()});case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"onChange",value:function(t,e){var n=this.state.total;e.target.checked?(this.props.addOutput(t),n+=t.value):(this.props.removeOutput(t),n-=t.value),this.setState({total:n})}},{key:"render",value:function(){var t=this;return r.a.createElement("div",null,r.a.createElement(g.a,null,r.a.createElement("h1",{className:"header"},"Select Unspent Outputs")),r.a.createElement(N.a.Group,null,r.a.createElement(A.a,{striped:!0,bordered:!0,hover:!0},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null),r.a.createElement("th",null),r.a.createElement("th",null,"TxID"),r.a.createElement("th",null,"Index"),r.a.createElement("th",null,"Value"))),r.a.createElement("tbody",null,this.state.outputs.map((function(e){return r.a.createElement("tr",{key:e.txid},r.a.createElement("td",null,r.a.createElement("input",{type:"checkbox",value:e.txid+e.vout,onChange:t.onChange.bind(t,e),checked:t.props.outputs.has(e.key())})),r.a.createElement("td",null,r.a.createElement(C.a,{text:e.txid},r.a.createElement(T.a,{style:{cursor:"pointer"}}))),r.a.createElement("td",null,e.txid.substr(0,10),"...",e.txid.substr(e.txid.length-10)),r.a.createElement("td",null,e.vout),r.a.createElement("td",null,y(e.value).toString()," BTC"))}))))))}}]),n}(a.Component),M=n(88),P=n(17),G=n(363),H=function(){return r.a.createElement(O.a,{variant:"primary",disabled:!0},r.a.createElement(w.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),r.a.createElement("span",{className:"sr-only"},"Loading..."))},W=function(t){Object(v.a)(n,t);var e=Object(f.a)(n);function n(){var t;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(t=e.call.apply(e,[this].concat(r))).state={recipient:"",satoshis:0,txFee:0,isSigning:!1,isSending:!1},t}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var t=0;this.props.outputs.forEach((function(e){return t+=e.value})),this.setState({satoshis:t})}},{key:"sendTx",value:function(){var t=Object(p.a)(l.a.mark((function t(e){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({isSending:!0}),t.prev=1,t.next=4,this.props.apiBtc.broadcastTx(e);case 4:n=t.sent,this.setState({txId:n}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),this.setState({error:t.t0});case 11:this.setState({isSending:!1});case 12:case"end":return t.stop()}}),t,this,[[1,8]])})));return function(e){return t.apply(this,arguments)}}()},{key:"createTransaction",value:function(){var t=Object(p.a)(l.a.mark((function t(){var e,n,a,r,c,u,o,h,d,m;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({error:void 0,txHex:void 0,txId:void 0,isSigning:!0}),e=this.state,n=e.recipient,a=e.satoshis,r=e.txFee,t.prev=2,c=this.props,u=c.appBtc,o=c.apiBtc,h=c.accounts,d=c.outputs,t.t0=E,t.t1=u,t.t2=a-r,t.next=9,Promise.all(Object(i.a)(d).map(function(){var t=Object(p.a)(l.a.mark((function t(e){var n,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object(s.a)(e,2),a=n[1],t.t0=P.a,t.next=4,o.getHexTransaction(a.txid);case 4:return t.t1=t.sent,t.t2=h.get(a.addr).index,t.t3={hex:t.t1,index:t.t2},t.t4=a,t.abrupt("return",(0,t.t0)(t.t3,t.t4));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 9:return t.t3=t.sent,t.t4=n,t.next=13,t.t0.createTransaction.call(t.t0,t.t1,t.t2,t.t3,t.t4);case 13:m=t.sent,this.setState({txHex:m}),t.next=20;break;case 17:t.prev=17,t.t5=t.catch(2),this.setState({error:t.t5});case 20:this.setState({isSigning:!1});case 21:case"end":return t.stop()}}),t,this,[[2,17]])})));return function(){return t.apply(this,arguments)}}()},{key:"handleChange",value:function(t){var e=t.target,n=e.name,a=e.value;this.setState(Object(M.a)({},n,a))}},{key:"render",value:function(){var t=this,e=this.state,n=e.satoshis,a=e.txHex,c=e.txId;return r.a.createElement("div",null,r.a.createElement(g.a,null,r.a.createElement("h1",{className:"header"},"Confirm & Sign"),r.a.createElement("p",null,"Enter the recipient and transaction fee before signing.")),r.a.createElement(N.a,null,r.a.createElement(N.a.Group,{controlId:"toAddress"},r.a.createElement(N.a.Label,null,"Recipient"),r.a.createElement(N.a.Control,{type:"text",placeholder:"Address",name:"recipient",onChange:this.handleChange.bind(this)})),r.a.createElement(N.a.Group,{controlId:"toAmount"},r.a.createElement(N.a.Label,null,"Amount"),r.a.createElement(N.a.Control,{type:"number",placeholder:y(n).toString(),readOnly:!0})),r.a.createElement(N.a.Group,{controlId:"txFee"},r.a.createElement(N.a.Label,null,"Transaction Fee"),r.a.createElement(N.a.Control,{type:"number",placeholder:"Fee",name:"txFee",onChange:this.handleChange.bind(this)})),r.a.createElement(N.a.Group,null,!this.state.isSigning&&r.a.createElement(O.a,{variant:"primary",type:"button",onClick:function(){return t.createTransaction()}},"Sign"),this.state.isSigning&&r.a.createElement(H,null)),a&&r.a.createElement(N.a.Group,{controlId:"txHex"},r.a.createElement(N.a.Label,null,"Raw Tx"),r.a.createElement(N.a.Control,{type:"text",value:a,readOnly:!0})),a&&!c&&r.a.createElement(N.a.Group,{controlId:"sendTx"},!this.state.isSending&&r.a.createElement(O.a,{variant:"primary",type:"button",onClick:function(){return t.sendTx(a)}},"Send"),this.state.isSending&&r.a.createElement(H,null)),c&&r.a.createElement(O.a,{onClick:function(){return window.open(function(t){return"https://www.blockchain.com/btc-testnet/tx/".concat(t)}(c))}},c," ",r.a.createElement(T.b,{className:"ml-2"})),this.state.error&&r.a.createElement(N.a.Group,null,r.a.createElement(G.a,{key:"ledgerErr",variant:"danger"},this.state.error.message))))}}]),n}(a.Component);function D(t){return new Promise((function(e){return setTimeout((function(){return e()}),t)}))}var F=function(t){Object(v.a)(n,t);var e=Object(f.a)(n);function n(t){var a;return Object(h.a)(this,n),(a=e.call(this,t)).state={apiBtc:new b,accounts:new Map,outputs:new Map,currentStep:1},a._next=a._next.bind(Object(m.a)(a)),a._prev=a._prev.bind(Object(m.a)(a)),a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var t=Object(p.a)(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=1,t.next=4,E.connect();case 4:return e=t.sent,t.next=7,E.getWalletAddress(e,0);case 7:return this.setState({appBtc:e}),t.abrupt("break",17);case 11:t.prev=11,t.t0=t.catch(1);case 13:return t.next=15,D(1e3);case 15:t.next=0;break;case 17:case"end":return t.stop()}}),t,this,[[1,11]])})));return function(){return t.apply(this,arguments)}}()},{key:"_next",value:function(){var t=this.state.currentStep;t=t>=3?3:t+1,this.setState({currentStep:t})}},{key:"_prev",value:function(){var t=this.state.currentStep;t=t<=0?0:t-1,this.setState({currentStep:t})}},{key:"updateAccount",value:function(t,e){var n=this.state.accounts;n.set(t,e(n.get(t)||{checked:!1,index:0,value:0})),this.setState({accounts:n})}},{key:"removeAccountOutputs",value:function(t){var e=this.state.outputs;e.forEach((function(n){t===n.addr&&e.delete(n.key())})),this.setState({outputs:e})}},{key:"addOutput",value:function(t){var e=this.state.outputs;e.set(t.key(),t),this.setState({outputs:e})}},{key:"removeOutput",value:function(t){var e=this.state.outputs;e.delete(t.key()),this.setState({outputs:e})}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},!this.state.appBtc&&r.a.createElement(k.a,null,r.a.createElement(g.a,null,r.a.createElement("h1",{className:"header"},"Connect Your Device"),r.a.createElement("p",null,"You may need to open the Bitcoin app.")),r.a.createElement(w.a,{as:"span",animation:"border",role:"status","aria-hidden":"true"})),this.state.appBtc&&r.a.createElement(k.a,null,1===this.state.currentStep&&r.a.createElement(I,Object.assign({updateAccount:this.updateAccount.bind(this),removeAccountOutputs:this.removeAccountOutputs.bind(this),appBtc:this.state.appBtc},this.state)),2===this.state.currentStep&&r.a.createElement(_,Object.assign({addOutput:this.addOutput.bind(this),removeOutput:this.removeOutput.bind(this),appBtc:this.state.appBtc},this.state)),3===this.state.currentStep&&r.a.createElement(W,Object.assign({appBtc:this.state.appBtc},this.state)),this.previousButton,this.nextButton))}},{key:"previousButton",get:function(){return this.state.currentStep>1?r.a.createElement(O.a,{variant:"secondary",className:"float-left",type:"button",onClick:this._prev},"Previous"):null}},{key:"nextButton",get:function(){var t=this.state,e=t.currentStep,n=t.accounts,a=t.outputs;return 1===e&&0===Object(i.a)(n).reduce((function(t,e){return t+(Object(s.a)(e,2)[1].checked?1:0)}),0)||2===e&&0===a.size?null:e<3?r.a.createElement(O.a,{variant:"primary",className:"float-right",type:"button",onClick:this._next},"Next"):null}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(353);u.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(F,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},49:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"connect",(function(){return v})),n.d(e,"getWalletAddress",(function(){return b})),n.d(e,"createTransaction",(function(){return E}));var a=n(17),r=n(1),c=n.n(r),u=n(4),s=n(124),i=n.n(s),o=n(166),l=n(125),p=n(123);n.d(e,"AppBtc",(function(){return p.a}));var h=n(69);function d(e,n){var a=e.toString(16),r=t.from(a.padStart(2*n,"0").slice(0,2*n),"hex");return r.reverse(),r}function m(t,e){return"".concat(function(t){return"".concat(t.purpose,"'/").concat(t.coinType,"'/").concat(t.account,"'/").concat(t.change)}(t),"/").concat(e)}var f={purpose:84,coinType:1,account:0,change:0};function v(){return x.apply(this,arguments)}function x(){return(x=Object(u.a)(c.a.mark((function t(){var e;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w();case 2:return e=t.sent,t.abrupt("return",new p.a(e));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(t,e){return y.apply(this,arguments)}function y(){return(y=Object(u.a)(c.a.mark((function t(e,n){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getWalletPublicKey(m(f,n),{format:"bech32"});case 2:return a=t.sent,t.abrupt("return",a.bitcoinAddress);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function E(t,e,n,a){return k.apply(this,arguments)}function k(){return(k=Object(u.a)(c.a.mark((function e(n,r,u,s){var i,o,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.map((function(t){return Object(a.a)({tx:n.splitTransaction(t.hex,!0)},t)})),o=h.payments.p2wpkh({address:s,network:h.networks.testnet}),l=n.serializeTransactionOutputs({version:t.from("01000000","hex"),inputs:[],outputs:[{amount:d(BigInt(r),8),script:o.output}]}).toString("hex"),e.abrupt("return",n.createPaymentTransactionNew({inputs:i.map((function(t){return[t.tx,t.vout,null,null]})),associatedKeysets:i.map((function(t){return m(f,t.index)})),outputScriptHex:l,segwit:!0,additionals:["bitcoin","bech32"]}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=function(){var t=Object(u.a)(c.a.mark((function t(){var e,n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.isSupported();case 2:return n=t.sent,t.abrupt("return",n&&"Windows"!==(null===(e=i.a.os)||void 0===e?void 0:e.family)&&"Opera"!==i.a.name);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),w=function(){var t=Object(u.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g();case 2:if(!t.sent){t.next=7;break}return t.abrupt("return",l.a.create());case 7:return t.abrupt("return",o.a.create(1e4,300));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}.call(this,n(2).Buffer)}},[[183,1,2]]]);
//# sourceMappingURL=main.fee7d318.chunk.js.map